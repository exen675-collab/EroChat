# EroChat

EroChat is a browser app for AI roleplay chat with automatic image generation.

It connects:
- **OpenRouter** or **Grok API** for text replies
- **SwarmUI** (local) or **Grok Imagine** for image generation

This project now includes a simple backend auth system:
- Username + password account creation
- Username + password login
- Session-based auth with cookies
- SQLite storage for users, sessions, and credits

## What it does

- Login-protected chat app
- Chat with custom characters
- Generate an image for each AI response (optional toggle)
- Create character thumbnails
- Save chats/settings/gallery in browser localStorage
- Keep chats/settings/gallery separate per logged-in user on the same browser
- Per-user credits (spent only on Grok text/image/video generations)
- Works on desktop and mobile layouts

## Run with Docker (recommended)

```bash
docker compose up -d --build
```

Open:
- `http://localhost:20121/` (login/create account)
- `http://localhost:20121/app/` (chat app after login)

### Docker notes

- `docker-compose.yml` maps `20121:20121`
- User/session database files are persisted in `./data`
- Set a real `SESSION_SECRET` in production
- Set `COOKIE_SECURE=true` only when running behind HTTPS
- Set `GROK_API_KEY` on the server (users do not need their own Grok key)
- Optional credit envs:
  - `DEFAULT_USER_CREDITS` (default: 100)
  - `CREDIT_COST_GROK_CHAT` (default: 1)
  - `CREDIT_COST_GROK_IMAGE` (default: 2)
  - `CREDIT_COST_GROK_VIDEO` (default: 3)

## Run without Docker

### 1) Install dependencies

```bash
npm install
```

### 2) Start server

```bash
npm start
```

Open:
- `http://localhost:20121/`

## Setup in the app

### Text Provider (OpenRouter or Grok)

1. Choose **Text Provider** in Settings
2. Paste your API key in the matching provider section
3. Click **Load ... Models**
4. Pick a model
5. `OpenRouter` uses each user's own key (no credits charged)
6. `Grok` uses server key and spends credits per generation

### Image Provider (optional)

1. Enable image generation if you want automatic images
2. Choose **Image Provider**
3. For `Local (SwarmUI)`: make sure SwarmUI is running, set URL, load models, pick model
4. For `Grok Imagine`: credits are charged and server Grok key is used

If image generation is disabled, chat works without image provider setup.

## Characters

You can create multiple characters with their own:
- name + emoji/avatar
- system prompt
- optional generated thumbnail

Tip: for better thumbnails, write a clear visual description (style, hair, clothing, mood, etc.).

## Project structure

```text
EroChat/
|-- server.js
|-- login.html
|-- package.json
|-- index.html
|-- css/
|   `-- styles.css
`-- js/
    |-- main.js
    |-- config.js
    |-- state.js
    |-- dom.js
    |-- events.js
    |-- ui.js
    |-- messages.js
    |-- characters.js
    |-- api-openrouter.js
    |-- api-grok.js
    |-- api-image.js
    |-- api-swarmui.js
    |-- storage.js
    `-- utils.js
```

## Privacy

- Login credentials are stored securely on the server (passwords hashed)
- OpenRouter keys stay in browser storage per user
- Grok key is stored only on server (`GROK_API_KEY`)
- Chat history/settings/gallery stay in your browser localStorage (separated per user)
- Images are generated by your selected image provider

## Troubleshooting

- **No reply from AI** -> Check provider, API key, and selected model
- **No images** -> Check image provider configuration (SwarmUI URL/model, Grok server key, and credits)
- **Slow responses** -> Try a lighter model or lower generation settings

## Notes

- Intended for adults (18+)
- Use responsibly and follow provider/local rules
- MIT licensed
